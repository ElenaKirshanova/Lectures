% !TeX program = xelatex
% !BIB TS-program = biber

\documentclass{beamer}

\usepackage[utf8]{inputenc}
\usepackage[russian]{babel}

%---tikz----
\usepackage{tikz}
\usetikzlibrary{arrows, chains, matrix, positioning, scopes, patterns, shapes}
\usepackage{pgfplots, subfigure}
\usepackage{extarrows}

\usepackage[backend=biber,firstinits=true,hyperref=true,style=numeric-comp]{biblatex}

\usepackage{../beamerthemeec2020}
{\footnotesize\bibliography{../biblio}}

\title{Эллиптические кривые}
\subtitle{Лекция 3. Точки $n$-кручения. Многочлены деления}
\author{Семён Новосёлов}
\institute{БФУ им. И. Канта}
\date{2022}

\begin{document}

\frame{\titlepage}

\begin{frame}{Точки $n$-кручения}
Пусть $n > 1$, $E$ -- эллиптической кривая над полем $K$.
\begin{itemize}
    \item \structure{Порядок точки} $P \in E$, $\operatorname{ord} P$ -- минимальное $n \in \mathbb{N}$, т.ч.
    \[
    [n] P = \mathcal{O}
    \]
    \item \structure{Точки $n$-кручения} -- элементы множества:
    \[
    E[n] = \left\{ {\left. P \in E(\bar K)\right| [n]P = \mathcal{O}} \right\}
    \]
\end{itemize}
\end{frame}


\begin{frame}{Случай $n=2$, $charK \ne 2$}
\[
E: {y^2} = f(x), ~ \deg f\left( x \right) = 3
\]
\structure{\[\Downarrow\]}
\[
y^2 = \left( {x - {e_1}} \right)\left( {x - {e_2}} \right)\left( {x - {e_3}} \right), e_i \in \overline{K}.
\]
\begin{center}
$\forall P \in E$: $[2] P = \mathcal{O}$ \structure{$\Leftrightarrow$} касательная $\ell$ в $P$ -- вертикальная
\end{center}
\structure{\[\Downarrow\]}
\[
y = 0
\]
\structure{\[\Downarrow\]}
\[
E[2] = \left\{ \mathcal{O}, (e_1, 0), (e_2 ,0), (e_3,0) \right\} \simeq \mathbb{Z}_2 \oplus \mathbb{Z}_2.
\]
    
\structure{Вывод}: нахождение точек $2$-кручения при $\operatorname{char}K \ne 2$ \structure{$\Leftrightarrow$} нахождение корней $f(x)$.
\end{frame}

\begin{frame}{Случай $n = 2$, $\operatorname{char} K = 2$}
    %\structure{$charK = 2$}: $\exists\: 2\text{ вида кривой } E$
%\begin{table}[]
    \begin{tabular}{cc}
        $E: {y^2} + xy = {x^3} + {a_2}{x^2} + {a_6}$ & $E:{y^2} + {a_3}y = x^3 + a_4 x + a_6$ \\
        $(a_6 \ne 0)$ & $(a_3 \ne 0)$ \\
        \structure{$ \Downarrow $} & \structure{$ \Downarrow $} \\
        \multicolumn{2}{c}{
            $P = (x,y)$, $[2] P =\mathcal{O}$ \structure{$\Rightarrow$} касательная к $P$ -- вертикаль \structure{$\Rightarrow$} $\frac{{dE}}{{dy}} = 0$
        } \\
        \structure{$ \Downarrow $} & \structure{$ \Downarrow $} \\
        $2y - x = 0$ & $\frac{{dE}}{{dy}} = {a_3}$ \\
        $x = 0$ (т.к. $2=0$) & ${a_3} \ne 0$ (иначе $E$ -- сингулярная) \\
        \structure{$ \Downarrow $} & \structure{$ \Downarrow $} \\
        ${y^2} = a_6$ & $E[2] = \left\{\mathcal{O}\right\}$ \\
        $P = (0, \sqrt{a_6})$ & \\
        $E[2] = \left\{ \mathcal{O}, (0, \sqrt a_6) \right\} \simeq \mathbb{Z}_2$ & \\
    \end{tabular}
%\end{table}
\end{frame}

\begin{frame}{Структура группы $2$-кручения}
\begin{block}{Лемма 1}
    Для эллиптической кривой $E$ над $K$ выполняется:
    \begin{align*}
        E[2] & \simeq \mathbb{Z}_2 \oplus \mathbb{Z}_2 & \text{при }\operatorname{char} K \ne 2 \\
        E[2] & \simeq 0 \text{ или } E[2] \simeq \mathbb{Z}_2 & \text{ при } \operatorname{char} K = 2.
    \end{align*}
\end{block}
\end{frame}

\begin{frame}{Структура группы $n$-кручения}
Можно показать [Washington \S~3.1], что:
\begin{align*}
    E[3] &\simeq \mathbb{Z}_3 \oplus \mathbb{Z}_3, & {\text{ при }}\operatorname{char} K \ne 3 \\
    E[3] &\simeq 0 \text{ или } E[3] \simeq \mathbb{Z}_3, & {\text{ при }} \operatorname{char} K = 3
\end{align*}

В общем случае:

\begin{block}{Теорема}
    Пусть $E$ -- эллиптическая кривая над $K$ и $n \geqslant \mathbb{N}_+$. Тогда:
    \begin{itemize}
        \item $E[n] \simeq \mathbb{Z}_n \oplus \mathbb{Z}_n$, если $\operatorname{char} K \nmid n$ или $\operatorname{char} K = 0,$  
        \item $E[n] \simeq \mathbb{Z}_{n'} \oplus \mathbb{Z}_{n'}$ или $E[n] \simeq {\mathbb{Z}_n} \oplus \mathbb{Z}_{n'}$ если $\operatorname{char} K = p > 0$, $p|n$
        и $n = p^r \cdot n', p \nmid n'.$
    \end{itemize}
\end{block}
Док-во: [Washington \S~3.2].
\end{frame}

\begin{frame}{Типы кривых}
    Пусть эллиптическая кривая $E$ задана над $K$ и $\operatorname{char} K = p$. Тогда:
    \begin{itemize}
        \item $E[p] \simeq \mathbb{Z}_p$ $\Rightarrow$ кривая \structure{обычная}.
        \item $E[p] \simeq 0$ $\Rightarrow$ кривая \structure{суперсингулярная}.
        \begin{itemize}
            \item[\faExclamationTriangle] Не путать с сингулярными кривыми.
        \end{itemize}
    \end{itemize}
\end{frame}

\begin{frame}{Многочлены деления. Мотивация}
\structure{Применение}:
\begin{itemize}
    \item описывают отображение $n: P \mapsto [n] P$
    \item используются в алгоритме подсчета точек кривой
    \item используются в вычислениях изогений
\end{itemize}
\end{frame}

\begin{frame}{Многочлены деления. Определение}
\[E: y^2 = x^3 + A x + B \]
Многочлены деления ${\psi _m} \in \mathbb{Z}[ {x,y,A,B}]$ определяются рекуррентными соотношениями:
\begin{align*}
    {\psi _0} &= 0 \\
    {\psi _1} &= 1 \\
    {\psi _2} &= 2y \\
    {\psi _3} &= 3{x^4} + 6A{x^2} + 12Bx - {A^2} \\
    {\psi _4} &= 4{y}\left( {{x^6} + 5A{x^4} + 20B{x^3} - 5{A^2}{x^2} - 4ABx - 8{B^2} - {A^3}} \right) \\
    {\psi _{2m + 1}} &= {\psi _{m + 2}}\psi _m^3 - {\psi _{m - 1}}\psi _{m + 1}^3, \quad m \geqslant 2 \\
    {\psi _{2m}} &= {\left( {2y} \right)^{ - 1}} \cdot {\psi _m} \cdot \left( {{\psi _{m + 2}}\psi _{m - 1}^2 - {\psi _{m - 2}}\psi _{m + 1}^2} \right),\quad m \geqslant 3
\end{align*}
\structure{Получение}: из формул сложения в координатах Якоби.
\end{frame}



\begin{frame}{Многочлены деления. Свойства}
%(док-во: Was. Lemma 3.3)
\begin{enumerate}
    \item 
    ${\psi _n} \in \mathbb{Z}[x, y^2, A, B]$, если $n$ -- нечетное \\
    ${\psi _n} \in 2y\mathbb{Z}[x, y^2, A, B]$, если $n$ -- четное. 
    \item Определим
    \begin{align*}
        {\varphi _m} &= x \cdot \psi _m^2 - {\psi _{m + 1}}{\psi _{m - 1}} \\
        {\omega _m} &= {\left( {4y} \right)^{ - 1}}\left( {{\psi _{m + 2}}\psi _{m - 1}^2 - {\psi _{m - 2}}\psi _{m + 1}^2} \right) \\
        {\varphi _n} &\in \mathbb{Z}\left[ {x, {y^2},A,B} \right], \forall n \\
        {\omega _n} &\in y\mathbb{Z}\;\left[ {x, {y^2},A,B} \right], n{\text{  --  нечетное}} \\
        {\omega _n} &\in \mathbb{Z}\left[ {x, {y^2},A,B} \right],n{\text{ -- четное}}
    \end{align*}
    
    
    \item В многочленах ${\psi _n}$, ${\phi _n}$ можно сделать замену ${y^2} \mapsto {x^3} + Ax + B$. % и рассматривать их как многочлены от $x$ (в $\mathbb{Z}\left[ {x,A,B} \right]$).
    Тогда 
    \begin{align*}
        {\varphi _n}\left( x \right) &= {x^{{n^2}}} + {\text{ мономы степени }} < {n^2} \\
        \psi _n^2\left( x \right) &= {n^2}{x^{{n^2} - 1}} + {\text{ мономы степени }} < {n^2} - 1
    \end{align*}
\end{enumerate}
Док-во: [Washington, Lemma 3.3].
\end{frame}

\begin{frame}{Многочлены деления}
\begin{block}{Теорема}
    Пусть $E: {y^2} = {x^3} + Ax + B$, $P = \left( {x,y} \right) \in E$ и $n \in {\mathbb{N}_+ }$. Тогда
    \[[n] P = \left( {\frac{{{\phi _n}\left( x \right)}}{{\psi _n^2\left( x \right)}},\;\frac{{{\omega _n}\left( x \right)}}{{{{\left( {{\psi _n}\left( {x,y} \right)} \right)}^3}}}} \right)
    \]
\end{block}

Таким образом, отображение (эндоморфизм) <<умножение на $n$>> задается рациональными функциями.
\end{frame}

%\begin{frame}{Применение в криптографии}
%    \begin{itemize}
%        \item %Zcash, pairings, generation
%        \item %подсчёт точек
%    \end{itemize}
%\end{frame}

\begin{frame}{Билинейные отображения}
Пусть $E$ -- эллиптическая кривая над полем $K$ и $n \in \mathbb{N}_{+}$ и $\mu_n = \{x \in \overline{K} | x^n = 1\}$ -- группа корней степени $n$ из единицы.
    
\begin{block}{Теорема (спаривание Вейля)}
$\exists$ отображение
$
e_n: E[n] \times E[n] \rightarrow \mu_n
$
со свойствами:
\begin{enumerate}
\item $e_n(T,T) = 1$
\item $e_n(T,S) = e_n(S,T)^{-1}$
\item $e_n(S_1 + S_2, T) = e_n(S_1, T) e_n(S_2, T)$ \hfill \textit{(билинейность)} \\
$e_n(S, T_1 + T_2) = e_n(S, T_1) e_n(S, T_2)$
\item $e_n(S,T) = 1, \forall T \implies S = \mathcal{O}$ \hfill \textit{(невырожденность)}\\
$e_n(S,T) = 1, \forall S \implies T = \mathcal{O}$
\end{enumerate}
\end{block}

Другие билинейные отображения: спаривание Тейта, эта-спаривание.
\end{frame}

%\begin{frame}{Алгоритм Миллера}
%%todo: алгоритм для построения функций спариваний
%%todo: сравнить с алгоритмом быстрым умножением.
%\end{frame}

\begin{frame}{Билинейные отображения. Приложения}
\structure{Степень вложения:} минимальное целое $k$ т.ч. $E[n] \subseteq E(\mathbb{F}_{q^k})$.

\begin{itemize}
    \item Атака на DLOG: $|\left<P\right>| = n$, $Q = [l] P$.
    \begin{enumerate}
        \item Выбрать случайную точку $R$.
        \item $\alpha = e_n(P, R)$
        \item $\beta  = e_n(Q, R)$ \hfill 
        \begin{scriptsize}
        $(\beta = e_n(l P, R) = e_n(P, R)^l = \alpha^l)$
        \end{scriptsize}
        \item $l = DLOG(\alpha, \beta)$ в $\mathbb{F}_{q^k}$
    \end{enumerate}    
    \item Конструктивное использование: ZCash, IBE, BLS
\end{itemize}
\end{frame}

\begin{frame}{Цифровая подпись}{(дополнение к предыдущей лекции)}
	\structure{Общие параметры:} кривая $E$ над~$\mathbb{F}_q$, $P \in E(\mathbb{F}_q)$, $r = \operatorname{ord}(P)$.
	
	\vspace{1em}
	\structure{Подпись} := (\structure{Setup}, \structure{Sign}, \structure{Verify}).
	
	\vspace{1em}
	
	\structure{Setup:}
	\begin{enumerate}
		\item Пользователь \structure{\faUserSecret} выбирает секретный ключ~$a \in [1, r]$.
		\item Открытый ключ: $Q = [a] P$.
	\end{enumerate}

	\vspace{1em}
	\structure{Sign:}
	
	Для подписи сообщения~$m$ пользователь \structure{\faUserSecret}:
	\begin{enumerate}
		\item выбирает случайное~$k \in [1, r]$ и вычисляет $R = [k] P  = (x, y)$
		\item вычисляет~$s = k^{-1} (m + a x) \bmod{r}$
		\item подпись: $(m, R, s)$
	\end{enumerate}
\end{frame}

\begin{frame}
\structure{Verify:}

Для проверки подписи пользователь~\structure{\faCat}:
\begin{enumerate}
	\item вычисляет~$u_1 = s^{-1} m \bmod{r}$ и $u_2 = s^{-1} x \bmod{r}$
	\item $S = [u_1] P + [u_2] Q$
	\item проверяет равенство~$S = R$.
\end{enumerate}

\vspace{1em}
\structure{Корректность:}

\structure{$\triangleleft$}
$S = [u_1] P + [u_2] Q = [s^{-1} m] P + [s^{-1} x] Q = [s^{-1}] ([m] P + [x a] P) = [k] P = R$.
\structure{$\triangleright$}

\end{frame}

\begin{frame}{}
\begin{itemize}
	\item используется повсеместно в составе протокола TLS
	\item для безопасности схемы требуется ряд ограничений на параметры
	\item ECDSA/ГОСТ 34.10-2018
\end{itemize}
\end{frame}

%\begin{frame}{BLS}
%%Boneh-Lynn-Shacham (BLS)
%\end{frame}

\begin{frame}{Литература}
\nocite{Menezes1993}\nocite{Blake1999}\nocite{Washington2008}

\printbibliography


\begin{center}
    \begin{tcolorbox}[enhanced,hbox,colback=block-green-color-bg,colframe=subsection-color!120,title=Контакты,center title]
        \begin{varwidth}{\textwidth}
            \begin{center}
                \href{mailto:snovoselov@kantiana.ru}{snovoselov@kantiana.ru}
            \end{center}
        \end{varwidth}
    \end{tcolorbox}	
\end{center}

\structure{Страница курса:}\\
{\footnotesize
    \href{https://crypto-kantiana.com/semyon.novoselov/teaching/elliptic_curves_2022}{crypto-kantiana.com/semyon.novoselov/teaching/elliptic\_curves\_2022}
}
\end{frame}

\end{document}
